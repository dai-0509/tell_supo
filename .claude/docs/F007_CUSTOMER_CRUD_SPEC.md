# F007 顧客登録・編集機能 仕様書

最終更新: 2025-11-08  
対象: TellSupo 顧客管理システム

## 🎯 機能概要

営業担当者が顧客情報を登録・編集できる機能を提供する。

## 📋 要件定義

### 機能要件

#### F007-01: 顧客登録
- 新規顧客の基本情報を登録できる
- 必須項目の入力チェック
- 重複チェック（会社名+電話番号）
- 登録成功時は顧客詳細画面にリダイレクト

#### F007-02: 顧客編集  
- 既存顧客の情報を編集できる　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　
- 更新時は自分以外との重複チェック
- 更新成功時は顧客詳細画面にリダイレクト

### データ項目

| 項目名 | フィールド名 | 型 | 必須 | 最大長 | 制約 |
|--------|-------------|---|-----|--------|------|
| 会社名 | company_name | string | ✓ | 120 | unique (user_id + company_name) |
| 担当者名 | contact_name | string | | 60 | |
| メール | email | email | | 255 | unique (user_id + email) |
| 電話番号 | phone | string | | 30 | 正規化（ハイフン除去） |
| 業界 | industry | string | | 60 | |
| 温度感 | temperature_rating | enum | | | A/B/C/D/E/F |
| エリア | area | string | | 60 | |
| ステータス | status | string | | 30 | デフォルト: 'new' |
| 優先度 | priority | integer | | | 1-5, デフォルト: 3 |
| メモ | memo | text | | | |

## 🎨 UI/UX要件

### 画面構成
- 顧客登録フォーム（/customers/create）
- 顧客編集フォーム（/customers/{id}/edit）

### デザイン要件
- Tailwind CSS使用
- レスポンシブ対応（モバイルファースト）
- アクセシビリティ対応
- 必須項目の明示（赤いアスタリスク）
- エラーメッセージの日本語表示

### フォームレイアウト
```
[会社名*] [担当者名]
[メールアドレス] [電話番号]
[業界] [エリア]
[温度感] [優先度]
[メモ（複数行）]
[保存] [キャンセル]
```

## ⚙️ 技術要件

### バリデーション
- **会社名**: required, max:120, unique（同一ユーザー内）
- **担当者名**: max:60
- **email**: email, max:255, unique（同一ユーザー内、更新時は自分除外）
- **phone**: max:30, 数字とハイフンのみ、自動正規化
- **業界**: max:60
- **温度感**: in:A,B,C,D,E,F
- **エリア**: max:60
- **priority**: integer, between:1,5
- **memo**: max:2000

### データ正規化
- **phone**: ハイフン・スペース・括弧を除去し数字のみに統一
- **email**: 小文字に統一
- **company_name**: 前後の空白除去

## 🔄 ユースケース

### UC-01: 新規顧客登録
1. ユーザーが「新規顧客登録」ボタンをクリック
2. 登録フォームが表示される
3. 必須項目を入力し「保存」をクリック
4. バリデーション実行
5. 成功時: 顧客詳細画面にリダイレクト、成功メッセージ表示
6. 失敗時: エラーメッセージ表示、入力値保持

### UC-02: 顧客情報編集
1. ユーザーが顧客詳細画面で「編集」ボタンをクリック
2. 編集フォームが表示される（既存値セット済み）
3. 情報を変更し「保存」をクリック
4. バリデーション実行（自分は重複チェックから除外）
5. 成功時: 顧客詳細画面にリダイレクト、更新メッセージ表示
6. 失敗時: エラーメッセージ表示、入力値保持

## ✅ 受入基準

### 機能テスト
- [ ] 必須項目未入力でエラーメッセージが表示される
- [ ] 重複する会社名で登録時にエラーメッセージが表示される
- [ ] 重複するemailで登録時にエラーメッセージが表示される
- [ ] 電話番号のハイフンが自動で除去される
- [ ] 文字数制限を超えた場合にエラーメッセージが表示される
- [ ] 正常な入力で顧客が登録される
- [ ] 編集時に既存値がフォームに表示される
- [ ] 編集時に自分のレコードは重複チェックから除外される
- [ ] 保存成功時に適切なメッセージが表示される
- [ ] キャンセル時に前画面に戻る

### パフォーマンステスト
- [ ] バリデーションが2秒以内に完了する
- [ ] フォーム表示が1秒以内に完了する

### アクセシビリティテスト
- [ ] キーボードのみで全操作が可能
- [ ] フォーカス順序が適切
- [ ] エラーメッセージがスクリーンリーダーで読み上げ可能

## 🚫 制約事項

- 同一ユーザー内での会社名重複不可
- 同一ユーザー内でのemail重複不可
- 一度に編集できるのは1件のみ
- 削除機能は別機能として実装

## 📊 関連機能

- F005: 顧客一覧表示
- F006: 顧客検索・フィルタ
- F009: 顧客詳細表示
- F012: 架電記録登録（顧客選択）

## 🔗 関連ドキュメント

- データベース設計書
- 画面遷移図
- API仕様書（必要に応じて）